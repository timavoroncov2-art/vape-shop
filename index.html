// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Telegram
const TELEGRAM_BOT_TOKEN = '8368198224:AAFal9lXTHHIRD4rn-d0FqeVBKpVQrng88M';
const TELEGRAM_CHAT_ID = '1423502260';
const TELEGRAM_GROUP_ID = '-1003277435312';
const FRIEND_CHAT_ID = '6007551643';

// –ê–¥–º–∏–Ω –ø–∞—Ä–æ–ª—å
const ADMIN_PASSWORD = 'admin123';

// –î–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫—Ä–∞—Å–∏–≤—ã–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
let products = {
    // D.L.T.A.
    "delta_chicken": { 
        name: "D.L.T.A. - –ì—Ä—É–¥–∫–∞ –∏ –∫–æ—Ä–∏—Ü–∞", 
        price: 400, 
        stock: 1, 
        category: "delta",
        icon: "üçó",
        description: "–°–º–µ–ª—ã–π –≤–∫—É—Å –∫–æ–ø—á–µ–Ω–æ–π –∫—É—Ä–∏–Ω–æ–π –≥—Ä—É–¥–∫–∏ —Å —Ç–µ–ø–ª—ã–º–∏ –Ω–æ—Ç–∞–º–∏ –∫–æ—Ä–∏—Ü—ã",
        ingredients: "–¢–∞–±–∞–∫, –∫–æ—Ä–∏—Ü–∞, –∫–æ–ø—á–µ–Ω–æ—Å—Ç–∏"
    },
    "delta_pear": { 
        name: "D.L.T.A. - –ì—Ä—É—à–∞ –∏ –∫–æ—Ä–∏—Ü–∞", 
        price: 400, 
        stock: 1, 
        category: "delta",
        icon: "üçê",
        description: "–°–æ—á–Ω–∞—è —Å–ø–µ–ª–∞—è –≥—Ä—É—à–∞ –≤ –æ–±—ä—è—Ç–∏—è—Ö –∞—Ä–æ–º–∞—Ç–Ω–æ–π –∫–æ—Ä–∏—Ü—ã",
        ingredients: "–ì—Ä—É—à–∞, –∫–æ—Ä–∏—Ü–∞, –≤–∞–Ω–∏–ª—å"
    },
    "delta_irga1": { 
        name: "D.L.T.A. - –°–æ –≤–∫—É—Å–æ–º –∏—Ä–≥–∏", 
        price: 400, 
        stock: 1, 
        category: "delta",
        icon: "üçá",
        description: "–ù–µ–∂–Ω–∞—è –∏—Ä–≥–∞ —Å –ª–µ–≥–∫–æ–π –∫–∏—Å–ª–∏–Ω–∫–æ–π –∏ —è–≥–æ–¥–Ω—ã–º –ø–æ—Å–ª–µ–≤–∫—É—Å–∏–µ–º",
        ingredients: "–ò—Ä–≥–∞, –ª–µ—Å–Ω—ã–µ —è–≥–æ–¥—ã, –º—è—Ç–∞"
    },
    "delta_irga2": { 
        name: "D.L.T.A. - –°–æ –≤–∫—É—Å–æ–º –∏—Ä–≥–∏", 
        price: 400, 
        stock: 1, 
        category: "delta",
        icon: "üçá",
        description: "–£–Ω–∏–∫–∞–ª—å–Ω—ã–π –≤–∫—É—Å –¥–∏–∫–æ–π –∏—Ä–≥–∏ —Å –º–µ–¥–æ–≤—ã–º–∏ –Ω–æ—Ç–∫–∞–º–∏",
        ingredients: "–ò—Ä–≥–∞, –º–µ–¥, –¥–∏–∫–∏–µ —è–≥–æ–¥—ã"
    },
    
    // –ú–û–†–û–ó–ù–´–ô –î–ñ–û
    "morozny_currant": { 
        name: "–ú–û–†–û–ó–ù–´–ô –î–ñ–û - –°–º–æ—Ä–æ–¥–∏–Ω–∞ —Ö–≤–æ—è –∏ –º—è—Ç–∞", 
        price: 400, 
        stock: 1, 
        category: "morozny",
        icon: "‚ùÑÔ∏è",
        description: "–û—Å–≤–µ–∂–∞—é—â–∏–π –º–∏–∫—Å —á–µ—Ä–Ω–æ–π —Å–º–æ—Ä–æ–¥–∏–Ω—ã, —Ö–≤–æ–π–Ω–æ–≥–æ –ª–µ—Å–∞ –∏ –º—è—Ç—ã",
        ingredients: "–°–º–æ—Ä–æ–¥–∏–Ω–∞, —Ö–≤–æ—è, –º—è—Ç–∞, –º–µ–Ω—Ç–æ–ª"
    },
    
    // –•–ê–°–ö–ò-–ú–ò–®–ö–ò
    "husky_kiwi": { 
        name: "–•–ê–°–ö–ò-–ú–ò–®–ö–ò - –ö–∏–≤–∏ –º—è—Ç–∞", 
        price: 400, 
        stock: 1, 
        category: "husky",
        icon: "üê∫",
        description: "–≠–∫–∑–æ—Ç–∏—á–µ—Å–∫–∏–π –∫–∏–≤–∏ —Å –ø—Ä–æ—Ö–ª–∞–¥–Ω–æ–π –º—è—Ç–æ–π - –∏–¥–µ–∞–ª—å–Ω–æ–µ —Å–æ—á–µ—Ç–∞–Ω–∏–µ",
        ingredients: "–ö–∏–≤–∏, –º—è—Ç–∞, –ª–∞–π–º"
    },
    "husky_strawberry": { 
        name: "–•–ê–°–ö–ò-–ú–ò–®–ö–ò - –ö–ª—É–±–Ω–∏–∫–∞ –±–∞–Ω–∞–Ω", 
        price: 400, 
        stock: 1, 
        category: "husky",
        icon: "üê∫",
        description: "–°–ª–∞–¥–∫–∞—è –∫–ª—É–±–Ω–∏–∫–∞ –∏ –Ω–µ–∂–Ω—ã–π –±–∞–Ω–∞–Ω –≤ –∫—Ä–µ–º–æ–≤–æ–π –æ—Å–Ω–æ–≤–µ",
        ingredients: "–ö–ª—É–±–Ω–∏–∫–∞, –±–∞–Ω–∞–Ω, —Å–ª–∏–≤–∫–∏"
    },
    "husky_berries": { 
        name: "–•–ê–°–ö–ò-–ú–ò–®–ö–ò - –ë–æ—à–∫–∏ —è–≥–æ–¥—ã", 
        price: 400, 
        stock: 1, 
        category: "husky",
        icon: "üê∫",
        description: "–ú–∏–∫—Å –ª–µ—Å–Ω—ã—Ö —è–≥–æ–¥ —Å —Ö–≤–æ–π–Ω—ã–º–∏ –Ω–æ—Ç–∞–º–∏ –∏ —Å–ª–∞–¥–∫–∏–º –ø–æ—Å–ª–µ–≤–∫—É—Å–∏–µ–º",
        ingredients: "–õ–µ—Å–Ω—ã–µ —è–≥–æ–¥—ã, —Ö–≤–æ—è, –º–∞–ª–∏–Ω–∞"
    },
    
    // MALASIAN
    "malasian_lime": { 
        name: "MALASIAN - –õ–∞–π–º –∫–∏–≤–∏", 
        price: 400, 
        stock: 1, 
        category: "malasian",
        icon: "ü•ù",
        description: "–¢—Ä–æ–ø–∏—á–µ—Å–∫–∏–π –¥—É—ç—Ç —Å–æ—á–Ω–æ–≥–æ –ª–∞–π–º–∞ –∏ —Å–ø–µ–ª–æ–≥–æ –∫–∏–≤–∏",
        ingredients: "–õ–∞–π–º, –∫–∏–≤–∏, —Ç—Ä–æ–ø–∏—á–µ—Å–∫–∏–µ —Ñ—Ä—É–∫—Ç—ã"
    },
    "malasian_grape": { 
        name: "MALASIAN - –í–∏–Ω–æ–≥—Ä–∞–¥ –º–∞—Ä–º–µ–ª–∞–¥", 
        price: 400, 
        stock: 1, 
        category: "malasian",
        icon: "üçá",
        description: "–°–ª–∞–¥–∫–∏–π –≤–∏–Ω–æ–≥—Ä–∞–¥ –≤ –≤–∏–¥–µ –Ω–µ–∂–Ω–æ–≥–æ –º–∞—Ä–º–µ–ª–∞–¥–∞",
        ingredients: "–í–∏–Ω–æ–≥—Ä–∞–¥, –º–∞—Ä–º–µ–ª–∞–¥, —Å–∞—Ö–∞—Ä–Ω–∞—è –ø—É–¥—Ä–∞"
    },
    "malasian_passion": { 
        name: "MALASIAN - –ú–∞—Ä–∞–∫—É–π—è –∑–µ–ª–µ–Ω–æ–µ —è–±–ª–æ–∫–æ", 
        price: 400, 
        stock: 1, 
        category: "malasian",
        icon: "üçè",
        description: "–≠–∫–∑–æ—Ç–∏—á–µ—Å–∫–∞—è –º–∞—Ä–∞–∫—É–π—è –∏ —Ö—Ä—É—Å—Ç—è—â–µ–µ –∑–µ–ª–µ–Ω–æ–µ —è–±–ª–æ–∫–æ",
        ingredients: "–ú–∞—Ä–∞–∫—É–π—è, –∑–µ–ª–µ–Ω–æ–µ —è–±–ª–æ–∫–æ, —Ü–∏—Ç—Ä—É—Å—ã"
    },
    "malasian_cherry": { 
        name: "MALASIAN - –õ–∏—Å—Ç –≤–∏—à–Ω–µ–≤—ã–π —Å–æ–∫", 
        price: 400, 
        stock: 1, 
        category: "malasian",
        icon: "üçí",
        description: "–ù–∞—Å—ã—â–µ–Ω–Ω—ã–π –≤–∏—à–Ω–µ–≤—ã–π —Å–æ–∫ —Å –Ω–æ—Ç–∞–º–∏ –≤–∏—à–Ω–µ–≤–æ–≥–æ –ª–∏—Å—Ç–∞",
        ingredients: "–í–∏—à–Ω—è, –≤–∏—à–Ω–µ–≤—ã–π –ª–∏—Å—Ç, —è–≥–æ–¥—ã"
    },
    "malasian_raspberry": { 
        name: "MALASIAN - –ú–∞–ª–∏–Ω–∞ –±–∞–Ω–∞–Ω", 
        price: 400, 
        stock: 1, 
        category: "malasian",
        icon: "üçå",
        description: "–ê—Ä–æ–º–∞—Ç–Ω–∞—è –º–∞–ª–∏–Ω–∞ –∏ —Å–ø–µ–ª—ã–π –±–∞–Ω–∞–Ω –≤ —Å–ª–∏–≤–æ—á–Ω–æ–π –æ—Å–Ω–æ–≤–µ",
        ingredients: "–ú–∞–ª–∏–Ω–∞, –±–∞–Ω–∞–Ω, –≤–∞–Ω–∏–ª—å, —Å–ª–∏–≤–∫–∏"
    },
    "malasian_forest": { 
        name: "MALASIAN - –ö—Ä–∞—Å–Ω—ã–µ –ª–µ—Å–Ω—ã–µ —è–≥–æ–¥—ã", 
        price: 400, 
        stock: 1, 
        category: "malasian",
        icon: "üå≤",
        description: "–ë—É–∫–µ—Ç –∫—Ä–∞—Å–Ω—ã—Ö –ª–µ—Å–Ω—ã—Ö —è–≥–æ–¥: –º–∞–ª–∏–Ω–∞, –∑–µ–º–ª—è–Ω–∏–∫–∞, –±—Ä—É—Å–Ω–∏–∫–∞",
        ingredients: "–õ–µ—Å–Ω—ã–µ —è–≥–æ–¥—ã, –º–∞–ª–∏–Ω–∞, –∑–µ–º–ª—è–Ω–∏–∫–∞, –±—Ä—É—Å–Ω–∏–∫–∞"
    }
};

// –ö–æ—Ä–∑–∏–Ω–∞ –∏ –∑–∞–∫–∞–∑—ã
let cart = {};
let orders = []; // –£–ë–ò–†–ê–ï–ú localStorage –¥–ª—è –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
let currentOrder = null;
let uploadedScreenshot = null;
let isAdminLoggedIn = false;
let deliveryType = 'self';
let deliveryCost = 0;

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function init() {
    loadProducts();
    loadCart();
    loadAllOrders(); // –ó–ê–ì–†–£–ñ–ê–ï–ú –í–°–ï –ó–ê–ö–ê–ó–´ –ü–†–ò –ó–ê–ü–£–°–ö–ï
    renderProducts();
    selectDelivery('self');
    renderCart();
    renderUserOrders();
    showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ñ–ò–ñ–ê –ú–ê–†–ö–ï–¢! üöÄ', 'success');
}

// –ó–ê–ì–†–£–ó–ö–ê –í–°–ï–• –ó–ê–ö–ê–ó–û–í –ò–ó –û–ë–©–ï–ì–û –•–†–ê–ù–ò–õ–ò–©–ê
function loadAllOrders() {
    const allOrders = JSON.parse(localStorage.getItem('all_orders')) || [];
    orders = allOrders;
    console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤:', orders.length);
}

// –°–û–•–†–ê–ù–ï–ù–ò–ï –í–°–ï–• –ó–ê–ö–ê–ó–û–í –í –û–ë–©–ï–ï –•–†–ê–ù–ò–õ–ò–©–ï
function saveAllOrders() {
    localStorage.setItem('all_orders', JSON.stringify(orders));
    console.log('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –∑–∞–∫–∞–∑–æ–≤:', orders.length);
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∏–∑ localStorage
function loadProducts() {
    const savedProducts = localStorage.getItem('products');
    if (savedProducts) {
        products = JSON.parse(savedProducts);
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –≤ localStorage
function saveProducts() {
    localStorage.setItem('products', JSON.stringify(products));
}

// –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–¥–µ–ª
function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
    });
    
    document.querySelectorAll('.nav button').forEach(button => {
        button.classList.remove('active');
    });
    
    document.getElementById(sectionId).classList.add('active');
    
    if (sectionId === 'myOrders') {
        renderUserOrders();
    }
    
    if (sectionId === 'catalog') {
        renderProducts();
    }
    
    if (sectionId === 'admin' && isAdminLoggedIn) {
        loadAllOrders(); // –ü–ï–†–ï–ó–ê–ì–†–£–ñ–ê–ï–ú –ó–ê–ö–ê–ó–´ –ü–†–ò –û–¢–ö–†–´–¢–ò–ò –ê–î–ú–ò–ù–ö–ò
        renderAdminStats();
    }
    
    if (event && event.target) {
        event.target.classList.add('active');
    }
}

function showAdminSection() {
    if (isAdminLoggedIn) {
        showSection('admin');
        renderAdminStats();
    } else {
        showSection('admin');
        document.getElementById('adminLogin').style.display = 'block';
        document.getElementById('adminPanel').style.display = 'none';
    }
}

function loginToAdmin() {
    const password = document.getElementById('adminPassword').value;
    if (password === ADMIN_PASSWORD) {
        isAdminLoggedIn = true;
        document.getElementById('adminLogin').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadAllOrders(); // –ó–ê–ì–†–£–ñ–ê–ï–ú –í–°–ï –ó–ê–ö–ê–ó–´ –ü–†–ò –í–•–û–î–ï
        renderAdminStats();
        showNotification('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å! üîê', 'success');
    } else {
        showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å! ‚ùå', 'error');
    }
}

// –í—ã–±–æ—Ä –¥–æ—Å—Ç–∞–≤–∫–∏
function selectDelivery(type) {
    deliveryType = type;
    deliveryCost = type === 'city' ? 100 : 0;
    
    document.getElementById('deliverySelf').classList.toggle('selected', type === 'self');
    document.getElementById('deliveryCity').classList.toggle('selected', type === 'city');
    
    document.getElementById('radioSelf').checked = type === 'self';
    document.getElementById('radioCity').checked = type === 'city';
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∫–∏–¥–∫–µ
    const deliveryNote = document.getElementById('deliveryNote');
    if (type === 'self') {
        deliveryNote.innerHTML = 'üéâ <strong>–ê–∫—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–∞!</strong> 2 –±–∞–Ω–∫–∏ = 600‚ÇΩ, 3 –±–∞–Ω–∫–∏ = 900‚ÇΩ –∏ —Ç.–¥.';
    } else {
        deliveryNote.innerHTML = '‚ö†Ô∏è <strong>–ê–∫—Ü–∏—è –Ω–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç</strong> –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ - –≤—Å–µ –±–∞–Ω–∫–∏ –ø–æ 400‚ÇΩ';
    }
    
    renderCart();
}

// –†–µ–Ω–¥–µ—Ä —Ç–æ–≤–∞—Ä–æ–≤ —Å –∫—Ä–∞—Å–∏–≤—ã–º–∏ –æ–ø–∏—Å–∞–Ω–∏—è–º–∏
function renderProducts() {
    const grid = document.getElementById('productsGrid');
    grid.innerHTML = '';

    Object.keys(products).forEach(productId => {
        const product = products[productId];
        const productCard = document.createElement('div');
        productCard.className = `product-card ${product.category}`;
        
        let promoBadge = '';
        let soldOutBadge = '';
        
        if (product.stock > 0) {
            promoBadge = '<div class="promo-badge">üî• –ê–∫—Ü–∏—è</div>';
        } else {
            soldOutBadge = '<div class="sold-out-badge">‚ùå –ü–†–û–î–ê–ù–û</div>';
        }
        
        productCard.innerHTML = `
            ${promoBadge}
            ${soldOutBadge}
            <div class="brand-icon">${product.icon}</div>
            <h3>${product.name}</h3>
            <div class="flavor-description">${product.description}</div>
            <div class="ingredients">–°–æ—Å—Ç–∞–≤: ${product.ingredients}</div>
            <div class="price">${product.price} ‚ÇΩ</div>
            <div class="${product.stock > 0 ? 'stock' : 'out-of-stock'}">
                ${product.stock > 0 ? `‚úÖ –í –Ω–∞–ª–∏—á–∏–∏: ${product.stock} —à—Ç` : '‚ùå –ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏'}
            </div>
            <button onclick="addToCart('${productId}')" 
                    ${product.stock === 0 ? 'disabled' : ''}>
                ${product.stock > 0 ? 'üõí –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É' : '–¢–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è'}
            </button>
        `;
        
        grid.appendChild(productCard);
    });
}

// –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
function addToCart(productId) {
    console.log('–î–æ–±–∞–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä:', productId, '–í –Ω–∞–ª–∏—á–∏–∏:', products[productId].stock);
    
    // –ü–†–û–í–ï–†–ö–ê 1: –ï—Å—Ç—å –ª–∏ —Ç–æ–≤–∞—Ä –≤ –Ω–∞–ª–∏—á–∏–∏?
    if (products[productId].stock === 0) {
        showNotification('‚ùå –≠—Ç–æ—Ç —Ç–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è!', 'error');
        return;
    }

    // –ü–†–û–í–ï–†–ö–ê 2: –°–∫–æ–ª—å–∫–æ —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ?
    const currentInCart = cart[productId] || 0;
    console.log('–£–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ:', currentInCart);
    
    // –ü–†–û–í–ï–†–ö–ê 3: –ú–æ–∂–µ–º –ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –µ—â—ë –æ–¥–∏–Ω?
    if (currentInCart >= products[productId].stock) {
        showNotification(`‚ùå –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${products[productId].stock} —à—Ç.`, 'error');
        return;
    }

    // –ï–°–õ–ò –í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´ - –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ—Ä–∑–∏–Ω—É
    if (cart[productId]) {
        cart[productId]++;
    } else {
        cart[productId] = 1;
    }

    // –ù–ï –°–ü–ò–°–´–í–ê–ï–ú –° –ü–†–û–î–ê–ñ–ò! –¢–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –∞–¥–º–∏–Ω–æ–º
    saveCart();
    renderCart();
    showNotification('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É! üõí', 'success');
    
    console.log('–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è - –∫–æ—Ä–∑–∏–Ω–∞:', cart);
    console.log('–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è - stock:', products[productId].stock);
}

// –†–∞–±–æ—Ç–∞ —Å –∫–æ—Ä–∑–∏–Ω–æ–π
function loadCart() {
    const savedCart = localStorage.getItem('cart');
    if (savedCart) {
        cart = JSON.parse(savedCart);
    }
}

function saveCart() {
    localStorage.setItem('cart', JSON.stringify(cart));
}

function removeFromCart(productId) {
    delete cart[productId];
    saveCart();
    renderCart();
    showNotification('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã', 'error');
}

function updateQuantity(productId, change) {
    if (cart[productId]) {
        const newQuantity = cart[productId] + change;
        
        // –ï–°–õ–ò –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç–∞–ª–æ 0 –∏–ª–∏ –º–µ–Ω—å—à–µ - —É–¥–∞–ª—è–µ–º
        if (newQuantity <= 0) {
            removeFromCart(productId);
            return;
        }
        
        // –ï–°–õ–ò —Ö–æ—Ç–∏–º –±–æ–ª—å—à–µ —á–µ–º –µ—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏ - –ë–õ–û–ö–ò–†–£–ï–ú
        if (newQuantity > products[productId].stock) {
            showNotification(`‚ùå –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${products[productId].stock} —à—Ç.`, 'error');
            return;
        }
        
        // –ï–°–õ–ò –≤—Å—ë –æ–∫ - –æ–±–Ω–æ–≤–ª—è–µ–º
        cart[productId] = newQuantity;
        saveCart();
        renderCart();
    }
}

function clearCart() {
    if (Object.keys(cart).length === 0) {
        showNotification('–ö–æ—Ä–∑–∏–Ω–∞ —É–∂–µ –ø—É—Å—Ç–∞!', 'error');
        return;
    }
    
    if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∫–æ—Ä–∑–∏–Ω—É?')) {
        cart = {};
        saveCart();
        renderCart();
        showNotification('–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞ üóëÔ∏è', 'error');
    }
}

// –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Å —É—á–µ—Ç–æ–º –∞–∫—Ü–∏–∏
function calculateTotal() {
    let total = 0;
    let itemCount = 0;
    
    Object.keys(cart).forEach(productId => {
        const quantity = cart[productId];
        const price = products[productId].price;
        
        if (deliveryType === 'self') {
            // –ê–∫—Ü–∏—è: 1=400, 2=600, 3=900, 4=1200, 5=1500 –∏ —Ç.–¥.
            total += Math.floor(quantity / 5) * 1500 + calculatePromoPrice(quantity % 5);
        } else {
            // –ë–µ–∑ –∞–∫—Ü–∏–∏ –ø—Ä–∏ –¥–æ—Å—Ç–∞–≤–∫–µ
            total += quantity * price;
        }
        
        itemCount += quantity;
    });
    
    total += deliveryCost;
    return { total, itemCount };
}

function calculatePromoPrice(quantity) {
    const promoPrices = { 0: 0, 1: 400, 2: 600, 3: 900, 4: 1200 };
    return promoPrices[quantity] || (quantity * 400);
}

// –†–µ–Ω–¥–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã
function renderCart() {
    const cartItems = document.getElementById('cartItems');
    const totalAmount = document.getElementById('totalAmount');
    const promoSavings = document.getElementById('promoSavings');
    
    if (Object.keys(cart).length === 0) {
        cartItems.innerHTML = `
            <div class="empty-state">
                <i>üõí</i>
                <h3>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h3>
                <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞</p>
            </div>
        `;
        totalAmount.textContent = '0';
        promoSavings.innerHTML = '';
        return;
    }
    
    cartItems.innerHTML = '';
    let regularPrice = 0;
    let promoPrice = 0;
    
    Object.keys(cart).forEach(productId => {
        const product = products[productId];
        const quantity = cart[productId];
        
        regularPrice += quantity * product.price;
        
        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
            <div class="cart-item-info">
                <div class="cart-item-name">${product.name}</div>
                <div class="cart-item-details">${product.description}</div>
            </div>
            <div class="cart-item-actions">
                <button class="btn-decrease" onclick="updateQuantity('${productId}', -1)">-</button>
                <span style="font-weight: bold; font-size: 1.2em; min-width: 30px; text-align: center;">${quantity}</span>
                <button class="btn-increase" onclick="updateQuantity('${productId}', 1)">+</button>
                <button class="btn-remove" onclick="removeFromCart('${productId}')">üóëÔ∏è</button>
            </div>
        `;
        cartItems.appendChild(cartItem);
    });
    
    const { total, itemCount } = calculateTotal();
    totalAmount.textContent = total;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫–æ–Ω–æ–º–∏—é –ø–æ –∞–∫—Ü–∏–∏
    if (deliveryType === 'self' && itemCount >= 2) {
        const savings = regularPrice - total + deliveryCost;
        if (savings > 0) {
            promoSavings.innerHTML = `üéâ –í—ã —ç–∫–æ–Ω–æ–º–∏—Ç–µ: ${savings} ‚ÇΩ`;
        } else {
            promoSavings.innerHTML = '';
        }
    } else {
        promoSavings.innerHTML = '';
    }
}

// –†–µ–Ω–¥–µ—Ä –∑–∞–∫–∞–∑–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function renderUserOrders() {
    const userOrdersList = document.getElementById('userOrdersList');
    
    // –ü–û–ö–ê–ó–´–í–ê–ï–ú –¢–û–õ–¨–ö–û –ó–ê–ö–ê–ó–´ –¢–ï–ö–£–©–ï–ì–û –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø (–∏–∑ –æ–±—â–µ–≥–æ —Å–ø–∏—Å–∫–∞)
    const userOrders = orders.filter(order => order.userDevice === getDeviceId());
    
    if (userOrders.length === 0) {
        userOrdersList.innerHTML = `
            <div class="empty-state">
                <i>üì¶</i>
                <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤</h3>
                <p>–°–¥–µ–ª–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ –≤ –∫–∞—Ç–∞–ª–æ–≥–µ!</p>
            </div>
        `;
        return;
    }
    
    userOrdersList.innerHTML = '';
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∑–∞–∫–∞–∑—ã –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
    const sortedOrders = [...userOrders].reverse();
    
    sortedOrders.forEach(order => {
        const orderElement = document.createElement('div');
        orderElement.className = 'order-summary';
        orderElement.style.marginBottom = '20px';
        
        let statusClass = 'status-pending';
        let statusText = '‚è≥ –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è';
        
        if (order.status === 'confirmed') {
            statusClass = 'status-confirmed';
            statusText = '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω';
        } else if (order.status === 'completed') {
            statusClass = 'status-completed';
            statusText = 'üöÄ –ó–∞–≤–µ—Ä—à–µ–Ω';
        } else if (order.status === 'cancelled') {
            statusClass = 'status-cancelled';
            statusText = '‚ùå –û—Ç–º–µ–Ω–µ–Ω';
        }
        
        orderElement.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                <div>
                    <h3>–ó–∞–∫–∞–∑ #${order.id}</h3>
                    <p><strong>–í—Ä–µ–º—è:</strong> ${order.timestamp}</p>
                    <p><strong>–î–æ—Å—Ç–∞–≤–∫–∞:</strong> ${order.deliveryType === 'self' ? '–°–∞–º–æ–≤—ã–≤–æ–∑' : '–î–æ—Å—Ç–∞–≤–∫–∞'}</p>
                </div>
                <div class="order-status-badge ${statusClass}">
                    ${statusText}
                </div>
            </div>
            
            <div style="margin: 15px 0;">
                <strong>–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</strong>
                ${Object.keys(order.items).map(productId => {
                    return `<div style="margin: 5px 0;">‚Ä¢ ${products[productId].name} √ó ${order.items[productId]}</div>`;
                }).join('')}
            </div>
            
            <div style="border-top: 2px solid #4caf50; padding-top: 10px; font-size: 1.2em; font-weight: bold;">
                –ò—Ç–æ–≥–æ: ${order.total} ‚ÇΩ
            </div>
            
            <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-top: 15px;">
                <strong>üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã:</strong><br>
                –ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –∑–∞–∫–∞–∑–∞ –ø–∏—à–∏—Ç–µ –≤ Telegram: <strong>@spank46</strong>
            </div>
        `;
        
        userOrdersList.appendChild(orderElement);
    });
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –¥–ª—è —Ä–∞–∑–ª–∏—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
function getDeviceId() {
    let deviceId = localStorage.getItem('deviceId');
    if (!deviceId) {
        deviceId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('deviceId', deviceId);
    }
    return deviceId;
}

// –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
function checkout() {
    if (Object.keys(cart).length === 0) {
        showNotification('–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É!', 'error');
        return;
    }
    
    showSection('checkout');
    renderOrderSummary();
}

function renderOrderSummary() {
    const orderSummary = document.getElementById('orderSummary');
    const { total, itemCount } = calculateTotal();
    
    let summaryHTML = `
        <h3>–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞:</h3>
        <div style="margin: 20px 0;">
            <strong>–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> ${deliveryType === 'self' ? '–°–∞–º–æ–≤—ã–≤–æ–∑' : '–î–æ—Å—Ç–∞–≤–∫–∞'} <br>
            <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏:</strong> ${deliveryCost} ‚ÇΩ <br>
            <strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤:</strong> ${itemCount} —à—Ç.
        </div>
        <h4>–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</h4>
    `;
    
    Object.keys(cart).forEach(productId => {
        const product = products[productId];
        const quantity = cart[productId];
        summaryHTML += `
            <div class="order-item">
                <div>${product.name} √ó ${quantity}</div>
                <div>${quantity * product.price} ‚ÇΩ</div>
            </div>
        `;
    });
    
    summaryHTML += `
        <div style="border-top: 3px solid #4caf50; padding-top: 15px; margin-top: 15px; font-size: 1.3em; font-weight: bold;">
            –ò—Ç–æ–≥–æ: ${total} ‚ÇΩ
        </div>
    `;
    
    orderSummary.innerHTML = summaryHTML;
}

function showPayment() {
    showSection('payment');
    document.getElementById('paymentAmount').textContent = calculateTotal().total;
    uploadedScreenshot = null;
    document.getElementById('uploadPreview').innerHTML = '';
    document.getElementById('confirmPaymentBtn').disabled = true;
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç–∞
function handleFileUpload(files) {
    if (files.length > 0) {
        const file = files[0];
        if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedScreenshot = e.target.result;
                document.getElementById('uploadPreview').innerHTML = `
                    <div style="text-align: center; margin: 20px 0;">
                        <img src="${e.target.result}" style="max-width: 300px; border-radius: 15px; border: 3px solid #4caf50;">
                        <p style="color: #4caf50; font-weight: bold;">‚úÖ –°–∫—Ä–∏–Ω—à–æ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω</p>
                    </div>
                `;
                document.getElementById('confirmPaymentBtn').disabled = false;
            };
            reader.readAsDataURL(file);
        } else {
            showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ!', 'error');
        }
    }
}

// –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã (–ë–ï–ó –°–ü–ò–°–ê–ù–ò–Ø –¢–û–í–ê–†–û–í!)
function confirmPayment() {
    if (!uploadedScreenshot) {
        showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞!', 'error');
        return;
    }

    if (Object.keys(cart).length === 0) {
        showNotification('–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!', 'error');
        return;
    }

    const { total, itemCount } = calculateTotal();
    const orderId = 'ORD' + Date.now();
    
    // –°–û–ó–î–ê–ï–ú –ó–ê–ö–ê–ó –ë–ï–ó –°–ü–ò–°–ê–ù–ò–Ø –¢–û–í–ê–†–û–í!
    const order = {
        id: orderId,
        items: { ...cart },
        total: total,
        deliveryType: deliveryType,
        deliveryCost: deliveryCost,
        screenshot: uploadedScreenshot,
        timestamp: new Date().toLocaleString('ru-RU'),
        status: 'pending',
        userDevice: getDeviceId() // –î–û–ë–ê–í–õ–Ø–ï–ú –ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–† –£–°–¢–†–û–ô–°–¢–í–ê
    };

    // –í–ê–ñ–ù–û: –ù–ï –°–ü–ò–°–´–í–ê–ï–ú –¢–û–í–ê–†–´! –¢–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∞–¥–º–∏–Ω–æ–º

    // –°–û–•–†–ê–ù–Ø–ï–ú –í –û–ë–©–ï–ï –•–†–ê–ù–ò–õ–ò–©–ï
    orders.push(order);
    saveAllOrders();

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
    sendOrderToTelegram(order);

    // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
    cart = {};
    saveCart();

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É—Å–ø–µ—Ö
    showSection('orderStatus');
    renderFinalOrderSummary();
    showNotification('‚úÖ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è. üì¶', 'success');
}

function renderFinalOrderSummary() {
    const finalOrderSummary = document.getElementById('finalOrderSummary');
    finalOrderSummary.innerHTML = `
        <h3>–í–∞—à –∑–∞–∫–∞–∑ ‚Ññ${currentOrder.id}</h3>
        <p><strong>–°—Ç–∞—Ç—É—Å:</strong> –û–∂–∏–¥–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ–ø–ª–∞—Ç—ã</p>
        <p><strong>–í—Ä–µ–º—è –∑–∞–∫–∞–∑–∞:</strong> ${currentOrder.timestamp}</p>
        <p><strong>–ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞:</strong> ${currentOrder.total} ‚ÇΩ</p>
        <p><strong>–¢–∏–ø –ø–æ–ª—É—á–µ–Ω–∏—è:</strong> ${currentOrder.deliveryType === 'self' ? '–°–∞–º–æ–≤—ã–≤–æ–∑' : '–î–æ—Å—Ç–∞–≤–∫–∞'}</p>
        
        <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin-top: 15px;">
            <strong>üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã:</strong><br>
            –î–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –≤ Telegram: <strong>@spank46</strong>
        </div>
        
        <div style="background: #fff3cd; padding: 15px; border-radius: 10px; margin-top: 15px; border-left: 4px solid #ffc107;">
            <strong>üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã:</strong><br>
            –ú—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞—à —Å–∫—Ä–∏–Ω—à–æ—Ç –æ–ø–ª–∞—Ç—ã. –û–±—ã—á–Ω–æ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç 5-15 –º–∏–Ω—É—Ç.<br>
            <strong>–ù–∞–ø–∏—à–∏—Ç–µ @spank46 –≤ Telegram</strong> –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏.
        </div>
    `;
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
async function sendOrderToTelegram(order) {
    const message = `
üõí –ù–û–í–´–ô –ó–ê–ö–ê–ó #${order.id}

üí∞ –°—É–º–º–∞: ${order.total} ‚ÇΩ
üöö –î–æ—Å—Ç–∞–≤–∫–∞: ${order.deliveryType === 'self' ? '–°–∞–º–æ–≤—ã–≤–æ–∑' : '–î–æ—Å—Ç–∞–≤–∫–∞ (+100‚ÇΩ)'}
‚è∞ –í—Ä–µ–º—è: ${order.timestamp}
üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${order.userDevice}

üì¶ –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:
${Object.keys(order.items).map(productId => {
    return `‚Ä¢ ${products[productId].name} √ó ${order.items[productId]}`
}).join('\n')}

üë§ –ö–æ–Ω—Ç–∞–∫—Ç—ã –∑–∞–∫–∞–∑—á–∏–∫–∞: –æ–∂–∏–¥–∞—é—Ç —É—Ç–æ—á–Ω–µ–Ω–∏—è
üì± Telegram –¥–ª—è —Å–≤—è–∑–∏: @spank46
    `.trim();

    try {
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –∑–∞–∫–∞–∑–∞
        await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                chat_id: TELEGRAM_GROUP_ID,
                text: message,
                parse_mode: 'HTML'
            })
        });

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∫—Ä–∏–Ω—à–æ—Ç
        if (order.screenshot) {
            await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    chat_id: TELEGRAM_GROUP_ID,
                    photo: order.screenshot,
                    caption: `–°–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞ –¥–ª—è –∑–∞–∫–∞–∑–∞ #${order.id}`
                })
            });
        }

        // –î—É–±–ª–∏—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥—Ä—É–≥—É
        await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                chat_id: FRIEND_CHAT_ID,
                text: `–ù–æ–≤—ã–π –∑–∞–∫–∞–∑! ${order.total}‚ÇΩ - #${order.id}`,
                parse_mode: 'HTML'
            })
        });

    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram:', error);
    }
}

// –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê –ê–î–ú–ò–ù–û–ú (–¢–û–õ–¨–ö–û –¢–£–¢ –°–ü–ò–°–´–í–ê–ï–ú –¢–û–í–ê–†–´!)
function confirmOrderByAdmin(orderId) {
    const order = orders.find(o => o.id === orderId);
    if (!order) return;

    // –ü–†–û–í–ï–†–Ø–ï–ú –î–û–°–¢–£–ü–ù–û–°–¢–¨ –¢–û–í–ê–†–û–í
    let canConfirm = true;
    Object.keys(order.items).forEach(productId => {
        if (order.items[productId] > products[productId].stock) {
            showNotification(`‚ùå –¢–æ–≤–∞—Ä "${products[productId].name}" –∑–∞–∫–æ–Ω—á–∏–ª—Å—è!`, 'error');
            canConfirm = false;
        }
    });

    if (!canConfirm) {
        showNotification('‚ùå –ù–µ–ª—å–∑—è –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑ - —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ!', 'error');
        return;
    }

    // –°–ü–ò–°–´–í–ê–ï–ú –¢–û–í–ê–†–´ –¢–û–õ–¨–ö–û –ü–†–ò –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ò
    Object.keys(order.items).forEach(productId => {
        products[productId].stock -= order.items[productId];
        console.log(`üì¶ –°–ø–∏—Å–∞–Ω–æ ${order.items[productId]} —à—Ç. ${productId}. –û—Å—Ç–∞–ª–æ—Å—å: ${products[productId].stock}`);
    });

    saveProducts();
    order.status = 'confirmed';
    saveAllOrders();
    
    renderAdminStats();
    renderProducts();
    showNotification(`‚úÖ –ó–∞–∫–∞–∑ #${orderId} –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω! –¢–æ–≤–∞—Ä—ã —Å–ø–∏—Å–∞–Ω—ã.`, 'success');
}

// –û–¢–ú–ï–ù–ê –ó–ê–ö–ê–ó–ê –ê–î–ú–ò–ù–û–ú
function cancelOrderByAdmin(orderId) {
    if (confirm(`–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑ #${orderId}?`)) {
        const order = orders.find(o => o.id === orderId);
        if (order) {
            // –í–û–ó–í–†–ê–©–ê–ï–ú –¢–û–í–ê–†–´ –ù–ê –°–ö–õ–ê–î (–µ—Å–ª–∏ —É–∂–µ –±—ã–ª–∏ —Å–ø–∏—Å–∞–Ω—ã)
            if (order.status === 'confirmed') {
                Object.keys(order.items).forEach(productId => {
                    products[productId].stock += order.items[productId];
                    console.log(`üîÑ –í–æ–∑–≤—Ä–∞—â–µ–Ω–æ ${order.items[productId]} —à—Ç. ${productId}`);
                });
                saveProducts();
            }
            
            order.status = 'cancelled';
            saveAllOrders();
            
            renderAdminStats();
            renderProducts();
            showNotification(`‚úÖ –ó–∞–∫–∞–∑ #${orderId} –æ—Ç–º–µ–Ω–µ–Ω. –¢–æ–≤–∞—Ä—ã –≤–æ–∑–≤—Ä–∞—â–µ–Ω—ã.`, 'success');
        }
    }
}

// –ó–ê–í–ï–†–®–ï–ù–ò–ï –ó–ê–ö–ê–ó–ê
function completeOrderByAdmin(orderId) {
    const order = orders.find(o => o.id === orderId);
    if (order) {
        order.status = 'completed';
        saveAllOrders();
        renderAdminStats();
        showNotification(`‚úÖ –ó–∞–∫–∞–∑ #${orderId} –∑–∞–≤–µ—Ä—à–µ–Ω!`, 'success');
    }
}

// –ê–¥–º–∏–Ω —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (–ü–û–ö–ê–ó–´–í–ê–ï–¢ –í–°–ï –ó–ê–ö–ê–ó–´ –°–û –í–°–ï–• –£–°–¢–†–û–ô–°–¢–í)
function renderAdminStats() {
    if (!isAdminLoggedIn) return;

    const allOrders = orders; // –í–°–ï –∑–∞–∫–∞–∑—ã –∏–∑ –æ–±—â–µ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
    const totalOrders = allOrders.length;
    const totalRevenue = allOrders.reduce((sum, order) => sum + order.total, 0);
    const completedOrders = allOrders.filter(order => order.status === 'completed').length;

    document.getElementById('totalOrders').textContent = totalOrders;
    document.getElementById('totalRevenue').textContent = totalRevenue + ' ‚ÇΩ';
    document.getElementById('completedOrders').textContent = completedOrders;

    // –°–ü–ò–°–û–ö –í–°–ï–• –ó–ê–ö–ê–ó–û–í
    const ordersList = document.getElementById('ordersList');
    ordersList.innerHTML = '<h3>–í—Å–µ –∑–∞–∫–∞–∑—ã (—Å–æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤):</h3>';

    if (allOrders.length === 0) {
        ordersList.innerHTML += '<p style="text-align: center; padding: 20px;">–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p>';
        return;
    }

    // –ü–û–ö–ê–ó–´–í–ê–ï–ú –í–°–ï –ó–ê–ö–ê–ó–´ –í –û–ë–†–ê–¢–ù–û–ú –ü–û–†–Ø–î–ö–ï (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
    allOrders.reverse().forEach(order => {
        const orderElement = document.createElement('div');
        orderElement.style.background = '#455a64';
        orderElement.style.padding = '20px';
        orderElement.style.borderRadius = '15px';
        orderElement.style.margin = '15px 0';
        orderElement.style.border = `3px solid ${
            order.status === 'completed' ? '#4caf50' : 
            order.status === 'confirmed' ? '#2196f3' : 
            order.status === 'cancelled' ? '#f44336' : '#ff9800'
        }`;

        let orderDetails = '';
        Object.keys(order.items).forEach(productId => {
            const productName = products[productId] ? products[productId].name : productId;
            orderDetails += `<div style="margin: 3px 0;">‚Ä¢ ${productName} √ó ${order.items[productId]}</div>`;
        });

        orderElement.innerHTML = `
            <div style="margin-bottom: 15px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <div>
                        <strong style="font-size: 1.2em;">#${order.id}</strong> - ${order.total} ‚ÇΩ
                    </div>
                    <span style="color: ${
                        order.status === 'completed' ? '#4caf50' : 
                        order.status === 'confirmed' ? '#2196f3' : 
                        order.status === 'cancelled' ? '#f44336' : '#ff9800'
                    }; font-weight: bold;">
                        ${order.status === 'completed' ? '‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω' : 
                          order.status === 'confirmed' ? '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω' : 
                          order.status === 'cancelled' ? '‚ùå –û—Ç–º–µ–Ω–µ–Ω' : '‚è≥ –û–∂–∏–¥–∞–µ—Ç'}
                    </span>
                </div>
                <div style="color: #ccc; font-size: 0.9em;">
                    <div>üìÖ ${order.timestamp}</div>
                    <div>üöö ${order.deliveryType === 'self' ? '–°–∞–º–æ–≤—ã–≤–æ–∑' : '–î–æ—Å—Ç–∞–≤–∫–∞ (+100‚ÇΩ)'}</div>
                    <div>üì± –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${order.userDevice || '–Ω–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
                </div>
            </div>
            
            <div style="background: #37474f; padding: 15px; border-radius: 10px; margin: 10px 0;">
                <strong style="color: #fff;">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</strong>
                ${orderDetails}
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                ${order.status === 'pending' ? `
                    <button onclick="confirmOrderByAdmin('${order.id}')" 
                            style="padding: 10px 15px; background: #4caf50; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; flex: 1;">
                        ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ —Å–ø–∏—Å–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
                    </button>
                    <button onclick="cancelOrderByAdmin('${order.id}')" 
                            style="padding: 10px 15px; background: #f44336; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; flex: 1;">
                        ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å
                    </button>
                ` : ''}
                
                ${order.status === 'confirmed' ? `
                    <button onclick="completeOrderByAdmin('${order.id}')" 
                            style="padding: 10px 15px; background: #2196f3; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; flex: 1;">
                        üöÄ –ó–∞–≤–µ—Ä—à–∏—Ç—å
                    </button>
                ` : ''}
                
                ${order.status === 'completed' ? `
                    <button style="padding: 10px 15px; background: #666; color: white; border: none; border-radius: 8px; font-size: 14px; flex: 1;" disabled>
                        ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω
                    </button>
                ` : ''}
                
                ${order.status === 'cancelled' ? `
                    <button style="padding: 10px 15px; background: #666; color: white; border: none; border-radius: 8px; font-size: 14px; flex: 1;" disabled>
                        ‚ùå –û—Ç–º–µ–Ω–µ–Ω
                    </button>
                ` : ''}
            </div>
        `;

        ordersList.appendChild(orderElement);
    });
}

// –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
function showNotification(message, type = 'success') {
    const notification = document.getElementById('notification');
    notification.textContent = message;
    notification.className = `notification ${type}`;
    notification.classList.add('show');
    
    setTimeout(() => {
        notification.classList.remove('show');
    }, 4000);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', init);
